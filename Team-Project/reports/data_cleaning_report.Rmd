---
title: "Data Cleaning Report"
subtitle: "Summer Olympics Gymnastics Home Advantage Analysis - Team 5"
author: "Han Nguyen (TXN200004), Matthew Bazzell (MXB116930), Carlos Flores (CEF200002)"
date: "November 4, 2025"
output:
  pdf_document:
    toc: false
    number_sections: false
---

```{r setup, include=FALSE}
# Set chunk options - hide code, show only output
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, fig.width = 7, fig.height = 4)

# Set working directory to project root
knitr::opts_knit$set(root.dir = "/home/han/Github/STAT3355-Data-Analysis/Team-Project")

# Load required libraries
library(knitr)
library(ggplot2)
```

\newpage

# Variable 1: Country Name Standardization and Size Categorization

## 1. Before Cleaning

### Problem Description

Our analysis requires merging data from five different sources: athlete records, Olympic host information, country sizes, GDP data, and population demographics. Each dataset uses different naming conventions for countries, making it impossible to merge them accurately.

**Key Issues Identified:**

1. **Inconsistent country names across datasets**: The same country appears with different names (e.g., "United States" vs "United States of America" vs "USA")
2. **No standardized identifier**: Without a common key, we cannot merge datasets
3. **Missing size categories**: For Question 3 of our research (analyzing whether country size affects home advantage), we need categorical size groupings
4. **Special cases**: Historical country changes (USSR → Russia) and co-hosting situations (1956 Olympics)

### Raw Data Sample

Below is a sample of the raw `country_sizes.csv` dataset showing country names without standardization:

```{r before-country-sizes}
# Load raw country sizes data
country_sizes_raw <- read.csv("raw_data/country_sizes.csv", stringsAsFactors = FALSE)

# Show sample - inconsistent names, no NOC codes
sample_raw <- country_sizes_raw[1:15, c("Rank", "Country", "Total_Area_km2", "Land_Area_km2")]

kable(sample_raw,
      caption = "Raw Country Sizes Data (Before Cleaning)",
      col.names = c("Rank", "Country Name", "Total Area (km²)", "Land Area (km²)"),
      format.args = list(big.mark = ","))
```

### Problems Illustrated

```{r before-issues}
# Show country name variations across datasets
athletes_raw <- read.csv("raw_data/Athletes_summer_games.csv", stringsAsFactors = FALSE)
hosts_raw <- read.csv("raw_data/olympic_hosts.csv", stringsAsFactors = FALSE)

# Get unique country names for a few key countries
usa_names <- data.frame(
  Dataset = c("Athletes", "Hosts", "Country Sizes"),
  Country_Name = c(
    unique(athletes_raw$Team[athletes_raw$NOC == "USA"])[1],
    unique(hosts_raw$Country[grepl("United States", hosts_raw$Country)])[1],
    "United States"
  ),
  stringsAsFactors = FALSE
)

kable(usa_names,
      caption = "Example: United States appears with different names",
      col.names = c("Dataset", "Country Name Used"))
```

**Summary of Issues:**

- **5 datasets** with inconsistent country naming
- **No common identifier** for merging
- **No size categories** for analysis (only raw area values)
- Approximately **230+ countries** need standardization


## 2. Cleaning Process

### What We Cleaned

We performed three main cleaning operations:

1. **Created NOC (National Olympic Committee) codes mapping**
   - NOC codes are standardized 3-letter identifiers used by the International Olympic Committee
   - Examples: USA (United States), CHN (China), GBR (Great Britain), FRA (France)
   - Mapped all country name variations to their official NOC codes

2. **Standardized country names** across all datasets
   - Athletes data already had NOC codes → used as reference
   - Manually mapped host countries, GDP countries, population countries
   - Handled special cases (USSR → RUS, co-hosts like 1956 Australia/Sweden)

3. **Created size categories** for analysis
   - **Small**: < 500,000 km²
   - **Medium**: 500,000 - 5,000,000 km²
   - **Large**: > 5,000,000 km²

### Why We Cleaned It

**Research Necessity:**
- **Question 3** asks: "Do smaller countries experience larger home advantage than larger nations?"
- Need to merge country sizes with athlete performance data
- Without NOC codes, merging is impossible

**Data Integration:**
- Must combine 5 datasets with different country name formats
- NOC codes provide the universal key for merging
- Size categories enable categorical statistical analysis

### Expected Outcome

After cleaning, we expect:
- Every country has a standardized NOC code
- All datasets can be merged using NOC as the key
- Countries are categorized into Small/Medium/Large groups
- Ready for Question 3 analysis (country size effects on home advantage)

\newpage

## 3. After Cleaning

```{r run-cleaning, include=FALSE}
# Run the cleaning script to generate country_info.csv
source("scripts/05_clean_country_info_v2.R", local = knitr::knit_global())
```

### Cleaned Data Sample

```{r after-country-info}
# Load cleaned country info
country_info <- read.csv("cleaned_data/country_info.csv", stringsAsFactors = FALSE)

# Show sample with NOC codes and size categories
sample_clean <- head(country_info[order(-country_info$total_area_km2), ], 15)

kable(sample_clean[, c("noc", "country_name", "total_area_km2", "country_size_category")],
      caption = "Cleaned Country Info Data (After Cleaning)",
      col.names = c("NOC", "Country Name", "Total Area (km²)", "Size Category"),
      format.args = list(big.mark = ","),
      row.names = FALSE)
```

### Size Category Distribution

```{r size-distribution-table}
# Create frequency table
size_dist <- as.data.frame(table(country_info$country_size_category))
colnames(size_dist) <- c("Size Category", "Number of Countries")

kable(size_dist,
      caption = "Distribution of Countries by Size Category")
```

```{r size-distribution-plot, fig.cap="Distribution of Country Size Categories", fig.height=4, fig.width=6}
# Create ggplot2 bar chart
size_plot_data <- as.data.frame(table(country_info$country_size_category))
colnames(size_plot_data) <- c("Category", "Count")

ggplot(size_plot_data, aes(x = Category, y = Count, fill = Category)) +
  geom_bar(stat = "identity", width = 0.7) +
  geom_text(aes(label = Count), vjust = -0.5, size = 4, fontface = "bold") +
  scale_fill_manual(values = c("Small" = "lightblue",
                                "Medium" = "lightgreen",
                                "Large" = "coral")) +
  scale_y_continuous(limits = c(0, max(size_plot_data$Count) * 1.15)) +
  labs(title = "Countries by Size Category",
       x = "Size Category",
       y = "Number of Countries") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.title = element_text(hjust = 0.5, face = "bold"),
        axis.text = element_text(size = 11),
        axis.title = element_text(size = 12, face = "bold"))
```

### Olympic Host Countries Coverage

```{r host-coverage}
# Check which host countries have size data
host_nocs <- c("GRE", "FRA", "USA", "GBR", "SWE", "BEL", "NED", "GER",
               "FIN", "AUS", "ITA", "JPN", "MEX", "CAN", "ESP", "BRA", "CHN", "KOR")

host_data <- country_info[country_info$noc %in% host_nocs,
                          c("noc", "country_name", "total_area_km2", "country_size_category")]
host_data <- host_data[order(host_data$country_name), ]

kable(host_data,
      caption = "Olympic Host Countries with Size Data",
      col.names = c("NOC", "Country Name", "Total Area (km²)", "Size Category"),
      format.args = list(big.mark = ","),
      row.names = FALSE)
```

### Summary Statistics

**Final Dataset Characteristics:**

- **Total countries**: `r nrow(country_info)` countries with size data
- **Olympic host countries covered**: `r sum(host_nocs %in% country_info$noc)` out of 18 major hosts
- **Small countries**: `r sum(country_info$country_size_category == "Small")`
- **Medium countries**: `r sum(country_info$country_size_category == "Medium")`
- **Large countries**: `r sum(country_info$country_size_category == "Large")`

**Key Improvements:**

1. All countries now have standardized NOC codes
2. Size categories created for Question 3 analysis
3. Ready to merge with other datasets (athletes, hosts, GDP, population)
4. Covers all major Olympic host nations

**Files Created:**

- `cleaned_data/noc_mapping.csv` - Master NOC lookup table (230+ countries)
- `cleaned_data/country_info.csv` - Country sizes with NOC codes and categories

\newpage

# Variable 2: Medal Outcome Variables

## 1. Before Cleaning

### Problem Description

Our research questions focus on whether hosting the Olympics provides a competitive advantage **in gymnastics**. To analyze this, we need clear, quantifiable outcome variables for athletic performance. However, the raw athlete dataset presents several challenges:

**Key Issues Identified:**

1. **Medal data is text-based**: The `Medal` column contains text values ("Gold", "Silver", "Bronze") or blank strings for no medal
2. **No numeric indicators**: Cannot easily calculate statistics or run regressions with text data
3. **No binary success indicators**: Need simple yes/no variables for "won a medal" or "won gold"
4. **Mixed with all sports**: The raw data contains 200+ sports; we only need gymnastics
5. **No gymnastics categorization**: Multiple gymnastics types (Artistic, Rhythmic, Trampoline) need to be identified and grouped

### Raw Data Sample

Below is a sample of the raw athlete dataset showing the Medal column and sport diversity:

```{r before-athletes}
# Load raw athletes data
athletes_raw_sample <- read.csv("raw_data/Athletes_summer_games.csv", stringsAsFactors = FALSE)

# Show sample focusing on Medal column issues
sample_athletes <- athletes_raw_sample[1:15, c("Name", "Sex", "NOC", "Year", "Sport", "Event", "Medal")]

kable(sample_athletes,
      caption = "Raw Athletes Data - Mixed Sports, Text-Based Medal Column",
      row.names = FALSE)
```

### Medal Distribution (Raw - All Sports)

```{r medal-before-stats}
# Show medal value frequencies for ALL sports (before filtering)
medal_freq <- data.frame(
  Medal_Value = c("Gold", "Silver", "Bronze", "No Medal (blank)"),
  Count = c(
    sum(athletes_raw_sample$Medal == "Gold", na.rm=TRUE),
    sum(athletes_raw_sample$Medal == "Silver", na.rm=TRUE),
    sum(athletes_raw_sample$Medal == "Bronze", na.rm=TRUE),
    sum(athletes_raw_sample$Medal == "" | is.na(athletes_raw_sample$Medal))
  )
)
medal_freq$Percentage <- round(100 * medal_freq$Count / nrow(athletes_raw_sample), 2)

kable(medal_freq,
      caption = "Medal Distribution in Raw Data (All Sports)",
      col.names = c("Medal Value", "Count", "Percentage (%)"),
      format.args = list(big.mark = ","))
```

**Summary of Issues:**

- Total athlete records across all summer Olympic sports
- Medal column is **text-based** ("Gold", "Silver", "Bronze", or blank)
- **No binary indicators** for statistical analysis
- **No point system** for weighting medal types
- **All sports mixed together** - cannot isolate gymnastics

\newpage

## 2. Cleaning Process

### What We Cleaned

We performed four main cleaning operations:

1. **Filtered to gymnastics only**
   - Identified all gymnastics-related sports: "Gymnastics", "Artistic Gymnastics", "Rhythmic Gymnastics", "Trampoline Gymnastics"
   - Kept only gymnastics records (removes 200+ other sports)
   - Created `sport_category = "Gymnastics"` for all records

2. **Created binary medal indicators**
   - `medal_won`: 1 if athlete won any medal (Gold/Silver/Bronze), 0 if no medal
   - `gold_medal`: 1 if athlete won gold specifically, 0 otherwise
   - These enable binary logistic regression and success rate calculations

3. **Created numeric medal points**
   - `medal_points`: Gold = 3, Silver = 2, Bronze = 1, No medal = 0
   - Enables weighted analysis and linear regression
   - Accounts for medal "quality" differences

4. **Preserved original Medal column**
   - Kept original text values for reference and verification
   - Allows comparison between raw and derived variables

### Why We Cleaned It

**Research Necessity:**
- **Questions 1 & 2** ask: "Do host nations win significantly more gymnastics medals?"
- Need quantifiable outcome variables to measure "winning more"
- Binary indicators enable hypothesis testing (proportions, chi-square tests)
- Numeric points enable regression analysis (dose-response relationships)

**Statistical Requirements:**
- Cannot run regression with text data
- Need binary (0/1) variables for logistic regression
- Need numeric variables for linear regression
- Medal points allow for weighted analysis (gold worth more than bronze)

**Focus on Gymnastics:**
- Our research is **specifically about gymnastics**, not all sports
- Gymnastics is subjectively judged, making it ideal for studying potential bias
- Filtering to gymnastics reduces dataset significantly

### Expected Outcome

After cleaning, we expect:
- Only gymnastics records retained (Artistic, Rhythmic, Trampoline)
- Three new quantifiable outcome variables (medal_won, gold_medal, medal_points)
- Original Medal column preserved for reference
- Approximately 10-15% medal rate (most athletes don't medal)
- Ready for statistical analysis of home advantage

\newpage

## 3. After Cleaning

```{r load-athletes-cleaned, include=FALSE}
# Load cleaned athletes data
athletes_cleaned <- read.csv("cleaned_data/athletes_cleaned.csv", stringsAsFactors = FALSE)
```

### Cleaned Data Sample

```{r after-athletes}
# Show sample with new medal variables
sample_clean <- head(athletes_cleaned[, c("Name", "Sex", "NOC", "Year", "gymnastics_type",
                                          "Medal", "medal_won", "gold_medal", "medal_points")], 15)

kable(sample_clean,
      caption = "Cleaned Athletes Data - Gymnastics Only with Medal Variables",
      col.names = c("Name", "Sex", "NOC", "Year", "Gymnastics Type",
                   "Medal (Original)", "Medal Won", "Gold Medal", "Medal Points"),
      row.names = FALSE)
```

### Medal Distribution (Cleaned - Gymnastics Only)

```{r medal-after-stats}
# Medal distribution for gymnastics
medal_freq_clean <- data.frame(
  Medal_Value = c("Gold", "Silver", "Bronze", "No Medal"),
  Count = c(
    sum(athletes_cleaned$gold_medal == 1),
    sum(athletes_cleaned$Medal == "Silver"),
    sum(athletes_cleaned$Medal == "Bronze"),
    sum(athletes_cleaned$medal_won == 0)
  )
)
medal_freq_clean$Percentage <- round(100 * medal_freq_clean$Count / nrow(athletes_cleaned), 2)

kable(medal_freq_clean,
      caption = "Medal Distribution After Cleaning (Gymnastics Only)",
      col.names = c("Medal Value", "Count", "Percentage (%)"),
      format.args = list(big.mark = ","))
```

### Gymnastics Type Distribution

```{r gymnastics-types}
# Show distribution by gymnastics type
gymn_type_dist <- as.data.frame(table(athletes_cleaned$gymnastics_type))
colnames(gymn_type_dist) <- c("Gymnastics Type", "Number of Records")

kable(gymn_type_dist,
      caption = "Distribution by Gymnastics Type",
      format.args = list(big.mark = ","))
```

```{r gymn-type-plot, fig.cap="Distribution of Gymnastics Types", fig.height=4.5, fig.width=7}
# Create ggplot2 bar chart
gymn_plot_data <- as.data.frame(table(athletes_cleaned$gymnastics_type))
colnames(gymn_plot_data) <- c("Type", "Count")

ggplot(gymn_plot_data, aes(x = reorder(Type, -Count), y = Count, fill = Type)) +
  geom_bar(stat = "identity", width = 0.7) +
  geom_text(aes(label = format(Count, big.mark = ",")),
            vjust = -0.5, size = 4, fontface = "bold") +
  scale_fill_manual(values = c("Artistic Gymnastics" = "lightblue",
                                "Rhythmic Gymnastics" = "coral",
                                "Trampoline Gymnastics" = "lightgreen")) +
  scale_y_continuous(limits = c(0, max(gymn_plot_data$Count) * 1.15),
                     labels = function(x) format(x, big.mark = ",")) +
  labs(title = "Gymnastics Records by Type",
       x = "Gymnastics Type",
       y = "Number of Records") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.title = element_text(hjust = 0.5, face = "bold", size = 14),
        axis.text.x = element_text(angle = 20, hjust = 1, size = 10),
        axis.text.y = element_text(size = 11),
        axis.title = element_text(size = 12, face = "bold"))
```

### New Variables Summary

```{r variable-summary}
# Summary of new medal variables
var_summary <- data.frame(
  Variable = c("medal_won", "gold_medal", "medal_points"),
  Type = c("Binary (0/1)", "Binary (0/1)", "Numeric (0-3)"),
  Meaning = c(
    "1 = won any medal, 0 = no medal",
    "1 = won gold, 0 = did not win gold",
    "Gold=3, Silver=2, Bronze=1, None=0"
  ),
  Summary = c(
    paste0(sum(athletes_cleaned$medal_won == 1), " medals"),
    paste0(sum(athletes_cleaned$gold_medal == 1), " golds"),
    paste0("Mean = ", round(mean(athletes_cleaned$medal_points), 3))
  )
)

kable(var_summary,
      caption = "New Medal Outcome Variables",
      col.names = c("Variable Name", "Type", "Meaning", "Summary"),
      row.names = FALSE)
```

### Summary Statistics

**Final Gymnastics Dataset Characteristics:**

- **Total records**: `r format(nrow(athletes_cleaned), big.mark=",")` gymnastics performances
- **Unique athletes**: `r format(length(unique(athletes_cleaned$Name)), big.mark=",")` individual gymnasts
- **Countries**: `r length(unique(athletes_cleaned$NOC))` different NOCs
- **Years covered**: `r min(athletes_cleaned$Year)` - `r max(athletes_cleaned$Year)` (`r length(unique(athletes_cleaned$Year))` Olympics)
- **Medal rate**: `r round(100 * sum(athletes_cleaned$medal_won) / nrow(athletes_cleaned), 2)`% of performances resulted in a medal

**Gender Distribution:**

```{r gender-dist}
gender_table <- as.data.frame(table(athletes_cleaned$Sex))
gender_table$Percentage <- round(100 * gender_table$Freq / nrow(athletes_cleaned), 1)
colnames(gender_table) <- c("Sex", "Count", "Percentage (%)")

kable(gender_table,
      format.args = list(big.mark = ","))
```

**Key Improvements:**

1. Filtered from all-sport records to gymnastics-only dataset
2. Created three quantifiable outcome variables for statistical analysis
3. Preserved original Medal column for verification
4. Standardized gymnastics types into categories
5. Ready for Questions 1 & 2 analysis (home advantage in gymnastics)

**Files Created:**

- `cleaned_data/athletes_cleaned.csv` - Gymnastics athletes with medal outcome variables

This cleaned variable enables us to answer **Questions 1 & 2**: *"Does hosting the Olympics provide a measurable competitive advantage in gymnastics?"* and *"Does the home advantage differ by gender?"*

\newpage

# Variable 3: GDP Data Reshaping and Per Capita Calculation

## 1. Before Cleaning

### Problem Description

Our research Question 4 investigates whether economic prosperity affects home advantage in gymnastics. To answer this, we need GDP data matched to Olympic years. However, the raw GDP dataset presents major structural and data quality challenges:

**Key Issues Identified:**

1. **Wide format structure**: GDP data has years as columns (65+ columns from 1960-2024), making it impossible to merge with other datasets
2. **Metadata rows**: First 4 rows contain metadata, not data
3. **Country name inconsistencies**: Same country naming issues as other datasets (no NOC codes)
4. **Missing values**: Many cells are empty strings rather than proper NA values
5. **No per capita calculation**: Only total GDP is provided, but population size varies dramatically across countries
6. **Non-Olympic years**: Includes all years, but we only need Olympic years

### Raw Data Sample (Wide Format)

Below is a sample showing the problematic wide format where years are columns:

```{r before-gdp-wide}
# Load raw GDP data (skip metadata rows)
gdp_raw <- read.csv("raw_data/gdp.csv", skip = 4, stringsAsFactors = FALSE)

# Show sample of wide format - years as columns
sample_countries <- c("United States", "China", "Brazil", "Australia")
sample_gdp_raw <- gdp_raw[gdp_raw$Country.Name %in% sample_countries,
                          c("Country.Name", "Country.Code", "X1996", "X2000", "X2004", "X2008", "X2012", "X2016", "X2020")]

# Convert to billions for readability
sample_gdp_display <- sample_gdp_raw
year_cols <- c("X1996", "X2000", "X2004", "X2008", "X2012", "X2016", "X2020")
for (col in year_cols) {
  sample_gdp_display[[col]] <- round(as.numeric(sample_gdp_raw[[col]]) / 1e9, 1)
}

kable(sample_gdp_display,
      caption = "Raw GDP Data - Wide Format (Years as Columns, GDP in Billions USD)",
      col.names = c("Country", "Code", "1996", "2000", "2004", "2008", "2012", "2016", "2020"),
      format.args = list(big.mark = ","),
      row.names = FALSE)
```

### Data Structure Issues

```{r gdp-structure-issues}
# Demonstrate the structural problems
structure_issues <- data.frame(
  Issue = c(
    "Data Format",
    "Number of Year Columns",
    "Metadata Rows",
    "Countries in Dataset",
    "Missing Values",
    "NOC Codes"
  ),
  Problem = c(
    "Wide format (years as columns)",
    paste(sum(grepl("^X[0-9]{4}$", names(gdp_raw))), "year columns"),
    "First 4 rows are metadata",
    paste(nrow(gdp_raw), "country rows"),
    "Empty strings instead of NA",
    "No standardized NOC codes"
  ),
  Impact = c(
    "Cannot merge with other datasets",
    "Impossible to filter by year",
    "Headers polluted with non-data",
    "Too many non-Olympic countries",
    "Numeric operations fail",
    "Cannot join with athletes/hosts data"
  )
)

kable(structure_issues,
      caption = "Summary of GDP Data Structural Problems",
      col.names = c("Issue", "Problem Description", "Impact on Analysis"))
```

**Summary of Issues:**

- **Wide format** with `r sum(grepl("^X[0-9]{4}$", names(gdp_raw)))` year columns
- Years span 1960-2024, but Olympics only held every 4 years
- Missing values represented as empty strings `""`
- No population data for per capita calculation
- Cannot merge with athlete/host datasets in current format

\newpage

## 2. Cleaning Process

### What We Cleaned

We performed seven major transformations:

1. **Skipped metadata rows**
   - Skipped first 4 rows containing data source information
   - Read from row 5 where actual headers begin

2. **Reshaped from wide to long format**
   - Converted 65+ year columns into rows
   - Created `year` column from column names (X1960 → 1960)
   - Transformed from ~270 rows × 69 columns to ~17,000+ rows × 4 columns
   - Each country-year combination now gets its own row

3. **Cleaned GDP values**
   - Converted empty strings `""` to proper `NA` values
   - Converted GDP from character to numeric type
   - Enables statistical calculations

4. **Filtered to Olympic years only**
   - Matched with summer Olympic years (1896-2020)
   - Removed non-Olympic years
   - Reduces dataset size and focuses on relevant years

5. **Added NOC standardization**
   - Used country codes as NOC identifiers
   - Enables merging with other cleaned datasets

6. **Merged with population data**
   - Loaded population-by-age-group dataset
   - Calculated total population (sum of all age groups)
   - Merged by NOC code and year

7. **Calculated GDP per capita**
   - Formula: `gdp_per_capita = GDP / total_population`
   - Accounts for country size differences
   - Enables fair economic comparisons

### Why We Cleaned It

**Research Necessity:**
- **Question 4** asks: "Does economic prosperity (GDP, demographics) affect the home advantage magnitude?"
- Need to compare rich vs poor host nations
- Raw GDP totals are misleading (China vs Singapore - both wealthy but different scales)
- GDP per capita provides meaningful economic prosperity measure

**Statistical Requirements:**
- Cannot merge wide-format data with long-format athlete records
- Need year as a variable for time-series analysis
- Must standardize across vastly different country populations
- Missing value handling required for statistical models

**Data Integration:**
- Reshaping to long format enables joining with athletes and hosts data
- NOC codes link all datasets together
- Olympic-year filtering ensures data alignment

### Expected Outcome

After cleaning, we expect:
- Long format with one row per country-year combination
- Only Olympic years included
- GDP and GDP per capita both available
- NOC codes for merging with other datasets
- Approximately 3,000-5,000 country-year records
- Ready for Question 4 economic analysis

\newpage

## 3. After Cleaning

```{r run-gdp-cleaning, include=FALSE}
# Run the GDP cleaning script (only if output doesn't exist)
if (!file.exists("cleaned_data/gdp_long.csv")) {
  source("scripts/04_clean_gdp.R", local = knitr::knit_global())
}
```

```{r load-gdp-cleaned, include=FALSE}
# Load cleaned GDP data
gdp_cleaned <- read.csv("cleaned_data/gdp_long.csv", stringsAsFactors = FALSE)
```

### Cleaned Data Sample (Long Format)

```{r after-gdp-long}
# Show sample of cleaned long format data
sample_nocs <- c("USA", "CHN", "BRA", "AUS")
sample_years <- c(1996, 2000, 2004, 2008, 2012, 2016, 2020)

gdp_sample <- gdp_cleaned[gdp_cleaned$noc %in% sample_nocs &
                          gdp_cleaned$year %in% sample_years,
                          c("noc", "country_name", "year", "gdp", "total_population", "gdp_per_capita")]

gdp_sample <- gdp_sample[order(gdp_sample$noc, gdp_sample$year), ]

kable(gdp_sample,
      caption = "Cleaned GDP Data - Long Format with Per Capita",
      col.names = c("NOC", "Country", "Year", "GDP (USD)", "Population", "GDP per Capita (USD)"),
      format.args = list(big.mark = ",", scientific = FALSE),
      row.names = FALSE)
```

### Before vs After Transformation

```{r before-after-comparison}
# Create comparison table
comparison <- data.frame(
  Aspect = c(
    "Data Format",
    "Number of Rows",
    "Number of Columns",
    "Years Included",
    "GDP Variable Type",
    "Missing Value Format",
    "Population Data",
    "GDP per Capita",
    "NOC Standardization",
    "Ready for Merge"
  ),
  Before = c(
    "Wide (years as columns)",
    "271 countries",
    "69 columns",
    "All years (1960-2024)",
    "Character (with empty strings)",
    "Empty strings \"\"",
    "No population",
    "Not available",
    "No NOC codes",
    "No - incompatible format"
  ),
  After = c(
    "Long (one row per country-year)",
    paste(format(nrow(gdp_cleaned), big.mark=","), "country-year combinations"),
    "6 columns",
    "Olympic years only (1960-2024)",
    "Numeric",
    "Proper NA values",
    "Total population included",
    "Calculated (GDP / population)",
    "NOC codes added",
    "Yes - can merge by NOC + year"
  )
)

kable(comparison,
      caption = "GDP Data Transformation Summary",
      col.names = c("Aspect", "Before Cleaning", "After Cleaning"))
```


```{r gdp-host-trends, fig.cap="GDP per Capita Trends for Some Selected Olympic Host Nations", fig.height=5, fig.width=8}
# Plot GDP per capita trends for major host countries
host_countries <- c("USA", "CHN", "GBR", "AUS", "BRA", "JPN")

gdp_hosts <- gdp_cleaned[gdp_cleaned$noc %in% host_countries &
                         !is.na(gdp_cleaned$gdp_per_capita), ]

ggplot(gdp_hosts, aes(x = year, y = gdp_per_capita, color = noc, group = noc)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 2) +
  scale_y_continuous(labels = function(x) paste0("$", format(x/1000, big.mark = ","), "K")) +
  scale_x_continuous(breaks = seq(1960, 2020, 10)) +
  labs(title = "GDP per Capita Trends for Olympic Host Nations",
       subtitle = "Olympic years only (1960-2020)",
       x = "Year",
       y = "GDP per Capita (USD)",
       color = "Country") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, face = "bold", size = 14),
        plot.subtitle = element_text(hjust = 0.5, size = 11),
        axis.text = element_text(size = 10),
        axis.title = element_text(size = 12, face = "bold"),
        legend.position = "bottom",
        legend.title = element_text(face = "bold"))
```

### GDP per Capita Comparison (2016 Olympics)

```{r gdp-2016-comparison}
# Compare GDP per capita for 2016 (Rio Olympics year)
gdp_2016 <- gdp_cleaned[gdp_cleaned$year == 2016 &
                        !is.na(gdp_cleaned$gdp_per_capita), ]

# Get top 10 and include Brazil (host)
top10 <- head(gdp_2016[order(-gdp_2016$gdp_per_capita), ], 10)
brazil <- gdp_2016[gdp_2016$noc == "BRA", ]

gdp_2016_sample <- unique(rbind(top10, brazil))
gdp_2016_sample <- gdp_2016_sample[order(-gdp_2016_sample$gdp_per_capita), ]

kable(gdp_2016_sample[, c("noc", "country_name", "gdp_per_capita")],
      caption = "GDP per Capita in 2016 (Rio Olympics) - Top 10 + Brazil",
      col.names = c("NOC", "Country", "GDP per Capita (USD)"),
      format.args = list(big.mark = ",", scientific = FALSE),
      row.names = FALSE)
```

### Summary Statistics

**Final GDP Dataset Characteristics:**

- **Total records**: `r format(nrow(gdp_cleaned), big.mark=",")` country-year combinations
- **Countries**: `r length(unique(gdp_cleaned$noc))` unique NOCs
- **Years covered**: `r min(gdp_cleaned$year, na.rm=TRUE)` - `r max(gdp_cleaned$year, na.rm=TRUE)`
- **Olympic years**: `r length(unique(gdp_cleaned$year))` Olympic years
- **Records with GDP**: `r format(sum(!is.na(gdp_cleaned$gdp)), big.mark=",")` (`r round(100*sum(!is.na(gdp_cleaned$gdp))/nrow(gdp_cleaned), 1)`%)
- **Records with GDP per capita**: `r format(sum(!is.na(gdp_cleaned$gdp_per_capita)), big.mark=",")` (`r round(100*sum(!is.na(gdp_cleaned$gdp_per_capita))/nrow(gdp_cleaned), 1)`%)

**Data Coverage by Era:**

```{r coverage-by-era}
# Calculate coverage by time period
gdp_cleaned$era <- cut(gdp_cleaned$year,
                       breaks = c(1959, 1979, 1999, 2024),
                       labels = c("1960-1979", "1980-1999", "2000-2024"))

coverage <- aggregate(cbind(has_gdp = !is.na(gdp_cleaned$gdp),
                            has_percap = !is.na(gdp_cleaned$gdp_per_capita)) ~ era,
                     data = gdp_cleaned,
                     FUN = function(x) paste0(sum(x), " (", round(100*mean(x), 1), "%)"))

kable(coverage,
      caption = "GDP Data Coverage by Time Period",
      col.names = c("Time Period", "Has GDP Data", "Has GDP per Capita"))
```

**Key Improvements:**

1. **Structural transformation**: Wide format (unusable) → Long format (mergeable)
2. **Data reduction**: From 65+ year columns to focused Olympic years only
3. **Value creation**: Added GDP per capita variable for meaningful comparisons
4. **Integration ready**: NOC codes enable joining with athletes and hosts datasets
5. **Statistical readiness**: Numeric types, proper NA handling, time-series ready

**Enables Question 4 Analysis:**

This cleaned variable allows us to investigate: *"Do wealthier host nations experience different home advantage effects? Does the economic prosperity of a country affect their gymnastics performance when hosting?"*

We can now compare:
- High vs low GDP per capita host nations
- GDP trends over time for repeat hosts
- Economic prosperity's correlation with home advantage magnitude

**Files Created:**

- `cleaned_data/gdp_long.csv` - Long format GDP with per capita calculations

\newpage
